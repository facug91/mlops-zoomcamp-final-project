<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fruit Classifier</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .drop-zone {
            border: 2px dashed #ccc;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            color: #aaa;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .drop-zone.dragover {
            background-color: #f0f8ff;
        }
        .preview {
            max-width: 200px;
            margin-top: 15px;
        }
    </style>
</head>
<body class="bg-light">
<div class="container py-5">
    <h1 class="text-center mb-4">Fruit Classifier</h1>
    <p class="text-center">Upload an image of one of the following fruits: apples, grapes, mangos, strawberries, or bananas.</p>

    <div class="row justify-content-center">
        <div class="col-md-6">
            <!-- Drop zone -->
            <div id="drop-zone" class="drop-zone mb-3">
                Drag & drop an image here or click to select
                <input type="file" id="file-input" accept="image/*" hidden>
            </div>

            <!-- Image preview -->
            <img id="preview-image" class="preview d-none" alt="Preview">

            <!-- Predict button -->
            <div class="text-center">
                <button id="predict-btn" class="btn btn-primary mt-3" disabled>Predict</button>
            </div>

            <!-- Result -->
            <div id="result" class="alert alert-info text-center mt-4 d-none"></div>
        </div>
    </div>
</div>

<script>
    const dropZone = document.getElementById("drop-zone");
    const fileInput = document.getElementById("file-input");
    const previewImage = document.getElementById("preview-image");
    const predictBtn = document.getElementById("predict-btn");
    const resultDiv = document.getElementById("result");

    let selectedFile = null;

    // Click to open file dialog
    dropZone.addEventListener("click", () => fileInput.click());

    // File selected via dialog
    fileInput.addEventListener("change", (e) => {
        handleFile(e.target.files[0]);
    });

    // Drag & drop handlers
    dropZone.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropZone.classList.add("dragover");
    });

    dropZone.addEventListener("dragleave", () => {
        dropZone.classList.remove("dragover");
    });

    dropZone.addEventListener("drop", (e) => {
        e.preventDefault();
        dropZone.classList.remove("dragover");
        if (e.dataTransfer.files.length) {
            handleFile(e.dataTransfer.files[0]);
        }
    });

    // Handle selected file
    function handleFile(file) {
        if (!file) return;
        selectedFile = file;
        previewImage.src = URL.createObjectURL(file);
        previewImage.classList.remove("d-none");
        predictBtn.disabled = false;
        resultDiv.classList.add("d-none");
    }

    // Predict button click
    predictBtn.addEventListener("click", async () => {
        if (!selectedFile) return;

        const formData = new FormData();
        formData.append("image", selectedFile);

        resultDiv.textContent = "Processing...";
        resultDiv.classList.remove("d-none", "alert-info", "alert-success", "alert-danger");
        resultDiv.classList.add("alert-info");

        try {
            const res = await fetch("/predict", {
                method: "POST",
                body: formData
            });

            const data = await res.json();
            console.log(data)
            console.log(data.predictions)
            console.log(data.predictions.label)
            console.log(data.predictions.prob)
            if (res.ok) {
                resultDiv.textContent = `Prediction: ${data.predictions.label} (Confidence: ${(data.predictions.prob * 100).toFixed(2)}%)`;
                resultDiv.classList.remove("alert-info");
                resultDiv.classList.add("alert-success");
            } else {
                resultDiv.textContent = data.error || "Error processing image.";
                resultDiv.classList.remove("alert-info");
                resultDiv.classList.add("alert-danger");
            }
        } catch (err) {
            resultDiv.textContent = "Connection error.";
            resultDiv.classList.remove("alert-info");
            resultDiv.classList.add("alert-danger");
        }
    });
</script>
</body>
</html>
